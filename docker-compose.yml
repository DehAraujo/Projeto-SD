version: '3.8'

services:
  server:
    build: ./part3-server
    depends_on:
      - proxy
    # Volumes e Environment para persistÃªncia/conexÃ£o (ADICIONE SE FALTAR)
    # environment:
    #   - PUB_ADDRESS=tcp://proxy:5557 
    #   - SUB_ADDRESS=tcp://proxy:5558
    # volumes:
    #   - ./data:/data 
    networks:
      - appnet

  client:
    build: ./part3-client
    depends_on:
      - proxy
      - server # Depende do servidor para Login
    # ðŸ’¡ REPLICAS: 2 Clientes em loop
    deploy:
      replicas: 2 
    networks:
      - appnet

  bot:
    build: ./part3-bot
    depends_on:
      - proxy
      - server # Depende do servidor para Login
    # ðŸ’¡ REPLICAS: 8 Bots em loop
    deploy:
      replicas: 8
    networks:
      - appnet

  proxy:
    build: ./part2-proxy
    ports:
      # Portas de PUB/SUB (5557:XPUB, 5558:XSUB)
      - "5557:5557" # XSUB (Entrada de Publicadores)
      - "5558:5558" # XPUB (SaÃ­da de Assinantes)
    networks:
      - appnet

  monitor:
    build: ./part3-monitor
    depends_on:
      - proxy
    networks:
      - appnet
    command: ["python", "monitor.py"]

networks:
  appnet:
    driver: bridge