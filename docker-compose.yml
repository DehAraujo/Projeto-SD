version: '3.8'

services:
  server:
    build: ./part3-server
    depends_on:
      - proxy
    volumes:                              # ðŸ”¥ deve ficar DENTRO do serviÃ§o
      - ./part3-server/data:/app/data     # persistÃªncia dos dados
    environment:
      - PUB_ADDRESS=tcp://proxy:5557
      - SUB_ADDRESS=tcp://proxy:5558
    networks:
      - appnet

  client:
    build: ./part3-client
    depends_on:
      - proxy
      - server
    deploy:
      replicas: 2
    networks:
      - appnet

  bot:
    build: ./part3-bot
    depends_on:
      - proxy
      - server
    deploy:
      replicas: 10
    networks:
      - appnet

  proxy:
    build: ./part3-proxy
    ports:
      - "5557:5557"   # XSUB (Entrada de Publicadores)
      - "5558:5558"   # XPUB (SaÃ­da de Assinantes)
    networks:
      - appnet

  monitor:
    build: ./part3-monitor
    depends_on:
      - proxy
    networks:
      - appnet
    command: ["python", "monitor.py"]

networks:
  appnet:
    driver: bridge
